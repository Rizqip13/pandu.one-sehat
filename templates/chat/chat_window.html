{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mx-auto mt-10 !max-w-2xl">

    <div class="flex justify-between items-center mb-4">
        <h1 class="text-2xl font-bold">Chat - {{ session.patient_id|title }}</h1>
        <div class="flex gap-2">
            <a href="{% url 'select_patient' %}" class="btn btn-outline btn-sm">Switch Patient</a>
            <a href="{% url 'new_chat_session' %}" class="btn btn-primary btn-sm">New Session</a> 
        </div>
    </div>

    <div id="chat-box" class="flex flex-col h-96 overflow-y-scroll bg-base-200 p-5 rounded-lg space-y-2">
        {% for message in messages %}
            {% include "chat/partials/message_bubble.html" %}
        {% endfor %}
    </div>

    <form hx-post="{% url 'send_message' %}" 
          hx-target="#chat-box" 
          hx-swap="beforeend" 
          hx-on::after-request="this.reset(); scrollChatBox();"
          class="mt-5 flex gap-2">
        {% csrf_token %}
        <input name="content" type="text" placeholder="Type your message..." class="input input-bordered w-full" required>
        <button type="submit" class="btn btn-primary">Send</button>
    </form>
</div>

<script src="{% static 'js/chat.js' %}"></script>
{% endblock %}
